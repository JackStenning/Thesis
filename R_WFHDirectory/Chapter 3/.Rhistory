#if (!require("BiocManager", quietly = TRUE))
# install.packages("BiocManager")
#BiocManager::install("TxDb.Hsapiens.UCSC.hg38.knownGene")
#BiocManager::install("ChIPseeker")
#BiocManager::install("EnsDb.Hsapiens.v86")
#BiocManager::install("clusterProfiler")
#BiocManager::install("AnnotationDbi")
#BiocManager::install("org.Hs.eg.db")
# Load libraries
library(ChIPseeker)
#if (!require("BiocManager", quietly = TRUE))
# install.packages("BiocManager")
BiocManager::install("TxDb.Hsapiens.UCSC.hg38.knownGene")
BiocManager::install("ChIPseeker")
BiocManager::install("EnsDb.Hsapiens.v86")
BiocManager::install("clusterProfiler")
BiocManager::install("AnnotationDbi")
BiocManager::install("org.Hs.eg.db")
# Load libraries
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
library(EnsDb.Hsapiens.v86)
library(clusterProfiler)
library(AnnotationDbi)
library(org.Hs.eg.db)
library(dplyr)
library(tidyr)
library(ggplot2)
#Set working directory
setwd("//userfs/jps558/w2k/Desktop/R_WorkingDirectory")
library(dplyr)
library(ggplot2)
library(stringr)
# Step 1: Compute mean and standard deviation (or SEM) per condition
df_summary <- df_clean %>%
mutate(
Condition = gsub(" - Rep [0-9]+", "", `Condition name`),
Condition_numeric = as.numeric(str_extract(Condition, "^[0-9.]+"))
) %>%
group_by(Condition, Condition_numeric) %>%
summarise(
Mean_Average = mean(Average, na.rm = TRUE),
SD = sd(Average, na.rm = TRUE),
SEM = SD / sqrt(n()),   # standard error of the mean
.groups = "drop"
)
# Install packages if needed
# install.packages("readxl")
# install.packages("dplyr")
# install.packages("ggplot2")
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)
#Set working directory
setwd("C:/Users/jps558/OneDrive - University of York/Desktop/R_WorkingDirectory/R_WFHDirectory/Chapter 3")
# Step 1: Read your Excel sheet
# Change "Sheet1" to the actual sheet name in your file
df <- read_excel("Cell counting across conditions.xlsx", sheet = "With 0.45 -0.55")
# Step 2: Clean condition names and extract numeric dose
df_clean <- df %>%
mutate(
Condition = gsub(" - Rep [0-9]+", "", `Condition name`),
Condition_numeric = as.numeric(str_extract(Condition, "^[0-9.]+"))
)
# Step 3: Compute mean and SD per condition
df_summary <- df_clean %>%
group_by(Condition, Condition_numeric) %>%
summarise(
Mean_Average = mean(Average, na.rm = TRUE),
SD = sd(Average, na.rm = TRUE),
.groups = "drop"
)
# Step 4: Plot with error bars (SD)
ggplot(df_summary, aes(x = reorder(Condition, Condition_numeric),
y = Mean_Average, fill = Condition)) +
geom_col() +
geom_errorbar(aes(ymin = Mean_Average - SD,
ymax = Mean_Average + SD),
width = 0.2, color = "black") +
theme_minimal(base_size = 14) +
labs(
title = "Average % Red per Condition (with SD error bars)",
x = "Condition",
y = "Average % Red"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
guides(fill = "none") +
coord_cartesian(ylim = c(5, 10))   # zoom to highlight range
View(df_summary)
View(df_clean)
# Install packages if needed
# install.packages("readxl")
# install.packages("dplyr")
# install.packages("ggplot2")
install.packages(c("readxl","dplyr","ggplot2","stringr","janitor"))
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(janitor)
# Install packages if needed
# install.packages("readxl")
# install.packages("dplyr")
# install.packages("ggplot2")
install.packages(c("readxl","dplyr","ggplot2","stringr","janitor"))
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(janitor)
#Set working directory
setwd("C:/Users/jps558/OneDrive - University of York/Desktop/R_WorkingDirectory/R_WFHDirectory/Chapter 3")
# ---- 1) Read the Excel file ----
df <- read_excel("Cell counting across conditions.xlsx", sheet = 1) %>%
clean_names()   # makes names like top_percent_red_1, condition_name, etc.
# ---- 2) find which column holds the condition text ----
cond_col <- if ("condition_name" %in% names(df)) {
"condition_name"
} else if ("condition" %in% names(df)) {
"condition"
} else {
stop("Couldn't find a condition column (looked for 'condition_name' or 'condition').")
}
# ---- 3) identify the four '% Red' columns (based on 'percent' in cleaned names) ----
percent_cols <- names(df)[str_detect(names(df), "percent")]
if (length(percent_cols) < 1) {
stop("No percent columns found. Check column names -- expect names containing 'percent' after clean_names().")
}
# (optional) print the percent columns found:
message("Using these percent columns for per-row averages: ", paste(percent_cols, collapse = ", "))
# ---- 4) compute per-row (replicate) average across the found % columns ----
df2 <- df %>%
# ensure percent columns are numeric
mutate(across(all_of(percent_cols), ~ as.numeric(.))) %>%
rowwise() %>%
mutate(rep_mean = mean(c_across(all_of(percent_cols)), na.rm = TRUE)) %>%
ungroup()
# ---- 5) clean the condition label and get numeric dose for ordering ----
df2 <- df2 %>%
mutate(
condition_clean = str_remove(.data[[cond_col]], "\\s*-\\s*Rep.*"),           # remove "- Rep 1/2"
condition_numeric = as.numeric(str_extract(condition_clean, "^[0-9.]+"))    # extract leading numeric (e.g. 0.35)
)
# ---- 6) summarize across replicates: mean and SD of the replicate means ----
df_summary <- df2 %>%
group_by(condition_clean, condition_numeric) %>%
summarise(
Mean = mean(rep_mean, na.rm = TRUE),
SD   = sd(rep_mean, na.rm = TRUE),
n_rep = sum(!is.na(rep_mean)),
.groups = "drop"
) %>%
mutate(
ymin = pmax(Mean - SD, 0),    # avoid negative lower error
ymax = Mean + SD
)
# show the computed table
print(df_summary)
# ---- 7) Plot: bars ordered by numeric dose, with SD error bars ----
p <- ggplot(df_summary, aes(x = reorder(condition_clean, condition_numeric),
y = Mean,
fill = condition_clean)) +
geom_col() +
geom_errorbar(aes(ymin = ymin, ymax = ymax), width = 0.2, color = "black") +
theme_minimal(base_size = 14) +
labs(title = "Average % Red per Condition (mean ± SD)",
x = "Condition",
y = "Mean % Red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
guides(fill = "none")
# If you want to zoom the y-axis (without dropping data), uncomment and set your limits:
# p <- p + coord_cartesian(ylim = c(5, 10))
print(p)
# ---- 8) (optional) Save plot as A5 @ 300 dpi ----
# ggsave("avg_percent_red_A5.png", plot = p,
#        width = 148/25.4, height = 210/25.4, units = "in", dpi = 300)
install.packages(c("readxl", "dplyr", "ggplot2", "stringr", "janitor"))
# ---- 7) Plot: bars ordered by numeric dose, with SD error bars ----
p <- ggplot(df_summary, aes(x = reorder(condition_clean, condition_numeric),
y = Mean,
fill = condition_clean)) +
geom_col() +
geom_errorbar(aes(ymin = ymin, ymax = ymax), width = 0.2, color = "black") +
theme_minimal(base_size = 14) +
labs(title = "Average Co-transfection Efficiency (mean ± SD)",
x = "Condition",
y = "Mean percentage of co-transfected cells (%)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
guides(fill = "none")
# If you want to zoom the y-axis (without dropping data), uncomment and set your limits:
p <- p + coord_cartesian(ylim = c(0, 10))
print(p)
p <- p + coord_cartesian(ylim = c(0, 12))
print(p)
# ---- 8) (optional) Save plot as A5 @ 300 dpi ----
ggsave("Average Co-transfection Efficiency (mean ± SD)", plot = p,
width = 210/25.4, height = 148/25.4)
# ---- 8) (optional) Save plot as A5 @ 300 dpi ----
ggsave("Average Co-transfection Efficiency (mean+- SD)", plot = p,
width = 210/25.4, height = 148/25.4)
# ---- 8) (optional) Save plot as A5 @ 300 dpi ----
ggsave("Average Co-transfection Efficiency (mean+- SD).png", plot = p,
width = 210/25.4, height = 148/25.4)
