# EF5/DMSO slopes
ef5_df <- slopes_df %>% filter(TreatmentGroup %in% treatments)
# Unique combinations of Metric, Day, Treatment for EF5/DMSO
combos <- ef5_df %>%
distinct(Metric, Day, TreatmentGroup) %>%
rename(Treatment = TreatmentGroup)
# Run rowwise t-tests safely
comparison_results <- combos %>%
rowwise() %>%
mutate(ttest = list({
cur_metric <- Metric
cur_day <- Day
cur_treat <- Treatment
# EF5/DMSO subset for this Metric/Day/Treatment
ef5_sub <- ef5_df %>% filter(Metric == cur_metric, Day == cur_day, TreatmentGroup == cur_treat)
# Vehicle subset (pooled across all days)
vehicle_sub <- vehicle_df %>% filter(Metric == cur_metric)
# Combine for t-test
df_sub <- bind_rows(
ef5_sub %>% select(Slope, TreatmentGroup),
vehicle_sub %>% select(Slope, TreatmentGroup)
)
# Factor order: Vehicle first
df_sub$TreatmentGroup <- factor(df_sub$TreatmentGroup, levels = c(vehicle_name, cur_treat))
# Run t-test
t.test(Slope ~ TreatmentGroup, data = df_sub) %>% tidy()
})) %>%
unnest(ttest) %>%
rename(
estimate_vehicle = estimate1,
estimate_treatment = estimate2
) %>%
mutate(
estimate_diff = estimate_treatment - estimate_vehicle
) %>%
select(Metric, Day, Treatment, estimate_vehicle, estimate_treatment, estimate_diff, conf.low, conf.high, statistic, p.value)
# Save results
write.csv(comparison_results, "Slope_Comparison_vs_PooledVehicle.csv", row.names = FALSE)
# -----------------------------
# Plot slopes (optional)
# -----------------------------
plot_width <- 6
plot_height <- 5
plot_dpi <- 300
for (metric in unique(slopes_df$Metric)) {
p <- ggplot(slopes_df %>% filter(Metric == metric), aes(x = Day, y = Slope, fill = TreatmentGroup)) +
geom_boxplot(alpha = 0.5, outlier.shape = NA, position = position_dodge(width = 0.7)) +
geom_jitter(aes(color = TreatmentGroup), position = position_jitterdodge(jitter.width = 0.15, dodge.width = 0.7), size = 2, alpha = 0.7) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(title = paste("Slope of", metric, "across Days"), y = "Slope (Value ~ Bin)", x = "Day") +
theme_minimal() +
theme(legend.position = "top")
ggsave(filename = paste0("EF5_Slopes_", metric, ".tiff"), plot = p, width = plot_width, height = plot_height, dpi = plot_dpi)
}
slopes_df %>%
count(Metric, Day, TreatmentGroup, name = "n_samples")
# Load necessary libraries
library(ggplot2)
library(car)
library(multcompView)
library(dplyr)
library(readxl)
library(tidyverse)
### Early Treatment
#Set working directory
setwd("C:/Users/jps558/OneDrive - University of York/Desktop/R_WorkingDirectory/R_WFHDirectory")
#Path data
Path_E = "EarlyAmiloride.xlsx"
#Get Data
raw_data_E <- read_excel(Path_E, sheet = "Sheet1")
#Create order
desired_order <- c("Vehicle control", "No Amiloride", "1 nM Amiloride", "10 nM Amiloride", "100 nM Amiloride", "1 µM Amiloride", "10 µM Amiloride", "100 µM Amiloride")
# Reshape the data
long_data <- raw_data_E %>%
pivot_longer(
cols = starts_with("Day"),
names_to = "Day",
values_to = "Size"
) %>%
mutate(
Day = str_remove(Day, "Day"),                 # Remove "Day" prefix
Day = factor(Day, levels = unique(Day)),      # Ensure day order is preserved
Condition = as.factor(Condition),     # Factor for grouping
Size = as.numeric(Size)                       # Ensure Size is numeric
)
# Quick check: print structure
# str(long_data)
long_data <- long_data %>%
mutate(
Condition = factor(Condition, levels = desired_order)
)
# Plot with cleaner layout
ggplot(long_data, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(
position = position_dodge(width = 0.75),
outlier.shape = NA, width = 0.6
) +
geom_jitter(
position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, shape = 21
) +
labs(
title = "Spheroid Size Over Time by Amiloride Concentration after treatment on day 2",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal() +
theme(
axis.text.x = element_text(size = 11),
legend.position = "right",
plot.title = element_text(size = 14, face = "bold")
)
#########Plot Day 7-13
# Convert Day to numeric for filtering
long_data_filtered <- long_data %>%
mutate(Day_num = as.numeric(as.character(Day))) %>%
filter(Day_num >= 7 & Day_num <= 13)
ggplot(long_data_filtered, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(position = position_dodge(0.75), outlier.shape = NA, width = 0.6) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, , shape = 21) +
labs(
title = "Spheroid Size from Day 7–13 by Amiloride Concentration after treatment on day 2",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal()
#ANOVA test
# Filter for a specific day
e_day7_data <- long_data %>% filter(Day == " 7")
e_day8_data <- long_data %>% filter(Day == " 8")
e_day9_data <- long_data %>% filter(Day == " 9")
e_day10_data <- long_data %>% filter(Day == " 10")
e_day11_data <- long_data %>% filter(Day == " 11")
e_day12_data <- long_data %>% filter(Day == " 12")
e_day13_data <- long_data %>% filter(Day == " 13")
# Run one-way ANOVA
e_anova_day7 <- aov(Size ~ Condition, data = e_day7_data)
e_anova_day8 <- aov(Size ~ Condition, data = e_day8_data)
e_anova_day9 <- aov(Size ~ Condition, data = e_day9_data)
e_anova_day10 <- aov(Size ~ Condition, data = e_day10_data)
e_anova_day11 <- aov(Size ~ Condition, data = e_day11_data)
e_anova_day12 <- aov(Size ~ Condition, data = e_day12_data)
e_anova_day13 <- aov(Size ~ Condition, data = e_day13_data)
# View summary
summary(e_anova_day7)
summary(e_anova_day8)
summary(e_anova_day9)
summary(e_anova_day10)
summary(e_anova_day11)
summary(e_anova_day12)
summary(e_anova_day13)
#Levene's test - make sure these values are more than 0.05 to use anova
leveneTest(Size ~ Condition, data = e_day7_data)
leveneTest(Size ~ Condition, data = e_day8_data)
leveneTest(Size ~ Condition, data = e_day9_data)
leveneTest(Size ~ Condition, data = e_day10_data)
leveneTest(Size ~ Condition, data = e_day11_data)
leveneTest(Size ~ Condition, data = e_day12_data)
leveneTest(Size ~ Condition, data = e_day13_data)
#Tukey test
ed7_tukey_result <- TukeyHSD(e_anova_day7)
ed8_tukey_result <- TukeyHSD(e_anova_day8)
ed9_tukey_result <- TukeyHSD(e_anova_day9)
ed10_tukey_result <- TukeyHSD(e_anova_day10)
ed11_tukey_result <- TukeyHSD(e_anova_day11)
ed12_tukey_result <- TukeyHSD(e_anova_day12)
ed13_tukey_result <- TukeyHSD(e_anova_day13)
# Convert Tukey result to data frame
ed7_tukey_df <- as.data.frame(ed7_tukey_result$Condition)
ed7_tukey_df$comparison <- rownames(ed7_tukey_df)
ed8_tukey_df <- as.data.frame(ed8_tukey_result$Condition)
ed8_tukey_df$comparison <- rownames(ed8_tukey_df)
ed9_tukey_df <- as.data.frame(ed9_tukey_result$Condition)
ed9_tukey_df$comparison <- rownames(ed9_tukey_df)
ed10_tukey_df <- as.data.frame(ed10_tukey_result$Condition)
ed10_tukey_df$comparison <- rownames(ed10_tukey_df)
ed11_tukey_df <- as.data.frame(ed11_tukey_result$Condition)
ed11_tukey_df$comparison <- rownames(ed11_tukey_df)
ed12_tukey_df <- as.data.frame(ed12_tukey_result$Condition)
ed12_tukey_df$comparison <- rownames(ed12_tukey_df)
ed13_tukey_df <- as.data.frame(ed13_tukey_result$Condition)
ed13_tukey_df$comparison <- rownames(ed13_tukey_df)
# Filter only significant comparisons
ed7_sig_tukey <- ed7_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed8_sig_tukey <- ed8_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed9_sig_tukey <- ed9_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed10_sig_tukey <- ed10_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed11_sig_tukey <- ed11_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed12_sig_tukey <- ed12_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
ed13_sig_tukey <- ed13_tukey_df %>%
filter(`p adj` < 0.05) %>%
separate(comparison, into = c("group1", "group2"), sep = "-")
### Late Treatment
#Path Data
Path_L = "LateAmiloride.xlsx"
#Get data
raw_data_L <- read_excel(Path_L, sheet = "Sheet1")
# Reshape the data
long_data_L <- raw_data_L %>%
pivot_longer(
cols = starts_with("Day"),
names_to = "Day",
values_to = "Size"
) %>%
mutate(
Day = str_remove(Day, "Day"),                 # Remove "Day" prefix
Day = factor(Day, levels = unique(Day)),      # Ensure day order is preserved
Condition = as.factor(Condition),     # Factor for grouping
Size = as.numeric(Size)                       # Ensure Size is numeric
)
# Quick check: print structure
# str(long_data)
long_data_L <- long_data_L %>%
mutate(
Condition = factor(Condition, levels = desired_order)
)
# Plot with cleaner layout
ggplot(long_data_L, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(
position = position_dodge(width = 0.75),
outlier.shape = NA, width = 0.6
) +
geom_jitter(
position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, shape = 21
) +
labs(
title = "Spheroid Size Over Time by Amiloride Concentration after treatment on day 9",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal() +
theme(
axis.text.x = element_text(size = 11),
legend.position = "right",
plot.title = element_text(size = 14, face = "bold")
)
#########Plot Day 7-13
# Convert Day to numeric for filtering
long_data_L_filtered <- long_data_L %>%
mutate(Day_num = as.numeric(as.character(Day))) %>%
filter(Day_num >= 7 & Day_num <= 13)
ggplot(long_data_L_filtered, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(position = position_dodge(0.75), outlier.shape = NA, width = 0.6) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, , shape = 21) +
labs(
title = "Spheroid Size from Day 7–13 by Amiloride Concentration after treatment on day 9",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal()
# Plot with cleaner layout
ggplot(long_data_L, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(
position = position_dodge(width = 0.75),
outlier.shape = NA, width = 0.6
) +
geom_jitter(
position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, shape = 21
) +
labs(
title = "Spheroid Size Over Time by Amiloride Concentration after treatment on day 9",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal() +
theme(
axis.text.x = element_text(size = 11),
legend.position = "right",
plot.title = element_text(size = 14, face = "bold")
)
dev.off()
# Load necessary libraries
library(ggplot2)
library(car)
library(multcompView)
library(dplyr)
library(readxl)
library(tidyverse)
library(ggpubr)
### Early Treatment
#Set working directory
setwd("C:/Users/jps558/OneDrive - University of York/Desktop/R_WorkingDirectory/R_WFHDirectory")
#Path data
Path_E = "EarlyAmilorideNoedge.xlsx"
#Get Data
raw_data_E <- read_excel(Path_E, sheet = "Sheet1")
#Create order
desired_order <- c("Vehicle control", "No Amiloride", "1 nM Amiloride", "10 nM Amiloride", "100 nM Amiloride", "1 µM Amiloride", "10 µM Amiloride", "100 µM Amiloride")
# Reshape the data
long_data <- raw_data_E %>%
pivot_longer(
cols = starts_with("Day"),
names_to = "Day",
values_to = "Size"
) %>%
mutate(
Day = str_remove(Day, "Day"),                 # Remove "Day" prefix
Day = factor(Day, levels = unique(Day)),      # Ensure day order is preserved
Condition = as.factor(Condition),     # Factor for grouping
Size = as.numeric(Size)                       # Ensure Size is numeric
)
# Quick check: print structure
# str(long_data)
long_data <- long_data %>%
mutate(
Condition = factor(Condition, levels = desired_order)
)
# Plot with cleaner layout
ggplot(long_data, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(
position = position_dodge(width = 0.75),
outlier.shape = NA, width = 0.6
) +
geom_jitter(
position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, shape = 21
) +
labs(
title = "(no edge) Spheroid Size Over Time by Amiloride Concentration after treatment on day 2",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal() +
theme(
axis.text.x = element_text(size = 11),
legend.position = "right",
plot.title = element_text(size = 14, face = "bold")
)
#########Plot Day 7-13
# Convert Day to numeric for filtering
long_data_filtered <- long_data %>%
mutate(Day_num = as.numeric(as.character(Day))) %>%
filter(Day_num >= 7 & Day_num <= 13)
ggplot(long_data_filtered, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(position = position_dodge(0.75), outlier.shape = NA, width = 0.6) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, , shape = 21) +
labs(
title = "(no edge) Spheroid Size from Day 7–13 by Amiloride Concentration after treatment on day 2",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal()
#ANOVA test
# Prepare empty list for sheets
tukey_sheets <- list()
all_significant <- data.frame()
# Loop through days 7 to 13
for (d in 7:13) {
df_day <- long_data_filtered %>% filter(Day_num == d)
if (nrow(df_day) < 2) next
# Run ANOVA
aov_result <- aov(Size ~ Condition, data = df_day)
aov_summary <- tidy(aov_result)
f_value <- aov_summary$statistic[1]
aov_p <- aov_summary$p.value[1]
# Run Tukey HSD
tukey <- TukeyHSD(aov_result)
tukey_df <- as.data.frame(tukey$Condition)
tukey_df$comparison <- rownames(tukey_df)
# Process into clean format
tukey_df <- tukey_df %>%
separate(comparison, into = c("group1", "group2"), sep = "-") %>%
mutate(
Day = d,
F_value = round(f_value, 3),
ANOVA_p = signif(aov_p, 3),
p_label = case_when(
`p adj` < 0.001 ~ "***",
`p adj` < 0.01  ~ "**",
`p adj` < 0.05  ~ "*",
TRUE            ~ "ns"
)
) %>%
select(Day, group1, group2, diff, lwr, upr, `p adj`, p_label, F_value, ANOVA_p)
# Add to list of sheets
tukey_sheets[[paste0("Day_", d)]] <- tukey_df
# Add significant only
sig_df <- tukey_df %>% filter(`p adj` < 0.05)
all_significant <- bind_rows(all_significant, sig_df)
}
# Add a sheet for only significant comparisons
tukey_sheets[["Significant_Only"]] <- all_significant
# Export to Excel file
write_xlsx(tukey_sheets, "early_noedges_tukey_anova_results_by_day.xlsx")
### Late Treatment
#Path Data
Path_L = "LateAmilorideNoedge.xlsx"
#Get data
raw_data_L <- read_excel(Path_L, sheet = "Sheet1")
# Reshape the data
long_data_L <- raw_data_L %>%
pivot_longer(
cols = starts_with("Day"),
names_to = "Day",
values_to = "Size"
) %>%
mutate(
Day = str_remove(Day, "Day"),                 # Remove "Day" prefix
Day = factor(Day, levels = unique(Day)),      # Ensure day order is preserved
Condition = as.factor(Condition),     # Factor for grouping
Size = as.numeric(Size)                       # Ensure Size is numeric
)
# Quick check: print structure
# str(long_data)
long_data_L <- long_data_L %>%
mutate(
Condition = factor(Condition, levels = desired_order)
)
# Plot with cleaner layout
ggplot(long_data_L, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(
position = position_dodge(width = 0.75),
outlier.shape = NA, width = 0.6
) +
geom_jitter(
position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, shape = 21
) +
labs(
title = "(no edge) Spheroid Size Over Time by Amiloride Concentration after treatment on day 9",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal() +
theme(
axis.text.x = element_text(size = 11),
legend.position = "right",
plot.title = element_text(size = 14, face = "bold")
)
#########Plot Day 7-13
# Convert Day to numeric for filtering
long_data_L_filtered <- long_data_L %>%
mutate(Day_num = as.numeric(as.character(Day))) %>%
filter(Day_num >= 7 & Day_num <= 13)
ggplot(long_data_L_filtered, aes(x = Day, y = Size, fill = Condition)) +
geom_boxplot(position = position_dodge(0.75), outlier.shape = NA, width = 0.6) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.75),
alpha = 0.4, size = 1, , shape = 21) +
labs(
title = "(no edge) Spheroid Size from Day 7–13 by Amiloride Concentration after treatment on day 9",
x = "Day",
y = "Spheroid Size (µm)",
fill = "Concentration"
) +
theme_minimal()
#ANOVA test
# Prepare empty list for sheets
Ltukey_sheets <- list()
Lall_significant <- data.frame()
# Loop through days 7 to 13
for (d in 7:13) {
Ldf_day <- long_data_L_filtered %>% filter(Day_num == d)
if (nrow(Ldf_day) < 2) next
# Run ANOVA
Laov_result <- aov(Size ~ Condition, data = Ldf_day)
Laov_summary <- tidy(Laov_result)
Lf_value <- Laov_summary$statistic[1]
Laov_p <- Laov_summary$p.value[1]
# Run Tukey HSD
Ltukey <- TukeyHSD(Laov_result)
Ltukey_df <- as.data.frame(Ltukey$Condition)
Ltukey_df$comparison <- rownames(Ltukey_df)
# Process into clean format
Ltukey_df <- Ltukey_df %>%
separate(comparison, into = c("group1", "group2"), sep = "-") %>%
mutate(
Day = d,
F_value = round(Lf_value, 3),
ANOVA_p = signif(Laov_p, 3),
p_label = case_when(
`p adj` < 0.001 ~ "***",
`p adj` < 0.01  ~ "**",
`p adj` < 0.05  ~ "*",
TRUE            ~ "ns"
)
) %>%
select(Day, group1, group2, diff, lwr, upr, `p adj`, p_label, F_value, ANOVA_p)
# Add to list of sheets
Ltukey_sheets[[paste0("Day_", d)]] <- Ltukey_df
# Add significant only
Lsig_df <- Ltukey_df %>% filter(`p adj` < 0.05)
Lall_significant <- bind_rows(Lall_significant, Lsig_df)
}
# Add a sheet for only significant comparisons
Ltukey_sheets[["Significant_Only"]] <- Lall_significant
# Export to Excel file
write_xlsx(Ltukey_sheets, "late_noedge_tukey_anova_results_by_day.xlsx")
