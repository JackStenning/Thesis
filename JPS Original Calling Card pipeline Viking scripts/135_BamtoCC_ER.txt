#!/bin/bash
#SBATCH --job-name=ERBamtoCC		 # Job name
#SBATCH --mail-type=END,FAIL             # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=jps558@york.ac.uk    # Where to send mail  
#SBATCH --ntasks=2                       # Run on a single CPU
#SBATCH --mem=100gb                      # Job memory request
#SBATCH --time=12:00:00                  # Time limit hrs:min:sec
#SBATCH --output=basic_job_%j.log        # Standard output and error log
#SBATCH --account=biol-hic-2020          # Project account

module load bio/SAMtools/1.9-foss-2018b
module load bio/BEDTools/2.30.0-GCC-11.2.0
module load lang/Miniconda3
source activate Callingcardspy
for dir in workingCCdata/202306_JS_BulkCC/ER*; do
	cd "$dir"
	for file in *final.bam; do
		python ../../../BamToCallingCard.py \
		    -b XP XJ \
		    -i "$file" \
		    > "$file".qbed
		done
	for mile in *final.bam.qbed; do
            mv "$mile" "${mile%%final.bam.qbed}.qbed"
        done
	cd  /mnt/lustre/groups/biol-hic-2020/jack
done